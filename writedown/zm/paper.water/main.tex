\documentclass[aip,jcp,a4paper,preprint,unsortedaddress,onecolumn,fleqn]{revtex4-1}
% \documentclass[reprint,unsortedadress,oneclumn]{revtex4-1}

\usepackage{amsmath,amssymb,amsfonts,latexsym}
\usepackage[dvips]{graphicx}
\usepackage{color}
\usepackage{indentfirst} 
\usepackage{rotating,booktabs}

\newcommand{\eps}{\varepsilon}
\newcommand{\recheck}[1]{{\color{red} #1}}
\newcommand{\redc}[1]{{\color{red} #1}}            
\newcommand{\bluec}[1]{{\color{blue} #1}}            
\newcommand{\vect}[1]{\textbf{\textit{#1}}}
\newcommand{\exc}{\textrm{ex}}
\newcommand{\systemsa}{S_0}
\newcommand{\systemsb}{S_1}
\newcommand{\systemsbp}{S'_1}
\newcommand{\systemma}{M_0}
\newcommand{\systemmb}{M_1}
\newcommand{\systemmbp}{M'_1}
\newcommand{\systemla}{L_0}
\newcommand{\systemlbp}{L'_1}
\newcommand{\systemlb}{L_1}


\begin{document}

\title{A Critical Appraisal of Zero-Multiple Method in Classical Water Simulation}
\author{Han Wang}
\email{han.wang@fu-berlin.de}
\affiliation{CAEP Software Center for High Performance Numerical Simulation, Huayuan Road 6, 100088 Beijing, China}
\author{Ikuo Fukuda}
\email{ifukuda@protein.osaka-u.ac.jp}
\affiliation{Institute for Protein Research, Osaka University, 3-2 Yamadaoka, Suita, Osaka 565-0871, Japan}
\affiliation{RIKEN (The Institute of Physical and Chemical Research), 2-1 Hirosawa, Wako, Saitama 351-0198, Japan}

\begin{abstract}
\end{abstract}

\maketitle

\section{Introduction}

A very short overview of the existing electrostatic interaction methods. Two classes in general:
Long-range treatment, e.g.~Ewald and derived methods like SPME.
Short-range treatment, like RF and ZM.

The importance of developing a short-range method for the electrostatic interaction.

Zero-Multiple method, an overview, achievements, successful applications.

The purpose of this work: Extensive and strict tests investigating the reliability of Zero-Multiple method in water simulation, which is the most important solvent.

The structure of the paper.

\section{Zero-Multiple Method}

Introduction of the ZM method, formula...

\recheck{If we want to discuss the issue of cut-off method, a short
  introduction of the group cut-off v.s.~the atom cut-off
  method. (will discuss the implementation in gromacs later)}



\section{Benchmark quantities}

In order to investigate the performance of ZM method, we simulation
the water system by using both SPME and ZM methods, and calculate a set
of \emph{benchmark quantities}.  This set covers a broad range of
water properties that are of general interest. It includes the
structure property (radial distribution function), the thermodynamic
properties (pressure, excess chemical potential, constant
volume/pressure heat capacity, isothermal compressibility, thermal
expansion coefficient), dielectric properties (dielectric constant and
Kirkwood-G factor) and dynamical properties (diffusion constant and
viscosity).
The definitions and computing methods of these quantities are provided in details
in Appendix.~\ref{appendix:benchmark}.
By comparing ZM to SPME, a good consistency in computing
the benchmark quantities would indicate a good accuracy of the ZM
method.
More importantly, the benchmark tests provide knowledge in the
stituations when the ZM method does not work so well, and help in
finding the way of tuning the working parameters to achieve higher accuracy.
The ZM method is also compared to the traditional short-range method: RF.


\section{Simulation protocols}

In this work, we focus on the water system modeled by
TIP3P~\cite{jorgensen1983comparison} point-charge water model.
% Other point-charge water models differ in the modeling parameters, and
The accuracy of ZM method in other water models is out of the scope of the current work.
However, since the point-charge water models share similar idea, and  only differ
in the model parameters, it is highly probable that ZM works well with other water models if it works
well with TIP3P.

All simulations were performed by Gromacs~4.6.5~\cite{hess2008gromacs, pronk2013gromacs} complied by GNU C compiler with single-precision floating point.
The size of the systems and corresponding number of molecules used for MD simulations are summarized in Tab.~\ref{tab:tmp1}.
The benchmark quantities were calculated in either  canonical (NVT) or isothermal-isobaric (NPT) ensemble, with equilibrium temperature $T=300$~K.
In order to simulate at the desired temperature,
the systems $\systemsb$ and $\systemsbp$ were coupled to Nose-Hoover~\cite{nose1984molecular,hoover1985canonical} thermostat with time-scale $\tau_T = 1.0$~ps,
while systems $\systemmb$, $\systemmbp$, $\systemla$, $\systemlb$ and $\systemlbp$ were coupled to Langevin thermostat with time-scale $\tau_T = 0.1$~ps.
In the NPT simulations, the systems were further coupled
to the Parrinello-Rahman barostat~\cite{parrinello1980crystal,parrinello1981polymorphic} (in Gromacs implementation)
with time-scale $\tau_P = 0.5$~ps to equilibriate the system at 1~Bar.
All systems were integrated with leap-frog scheme at a time-step of 0.001~ps.
The neighbor lists were updated every 5 time-steps.
The ``\texttt{group}'' cut-off scheme in Gromacs was used. In order to mimic the atomistic
cut-off manner, the radius for neighbor list building was set 0.3~nm
larger than the cut-off radius (the maximum of Coulomb cut-off and the van der Waals cut-off).
To make sure the van der Waals interactions were cut-off in a smooth way,
they are modified in a shell of $0.05$~nm width near the cut-off sphere by the Gromacs ``\texttt{shift}'' method.
The ZM method was implemented in Gromacs with the tabulated electrostatic interaction. A home-made code was used to generate the interaction tables.
The short-range part of SPME method is smoothed in a shell of $0.05$~nm width  by the Gromacs ``\texttt{pme-switch}'' method.
The reciprocal space
grid spacing is set to 0.06~nm, with B-Spline interpolation order of 6.
These parameters are chosen to be more accurate than the Gromacs default choices (grid spacing 0.12~nm and interpolation order 4).
The splitting parameter is optimized by the error estimate for the SPME method, which is implemented in Gromacs by tool ``\texttt{g\_pme\_error}''~\cite{wang2010optimizing}.
The optimized real space and reciprocal space force computing errors were equally distributed as $1.4\times10^{-4}$~kJ/(mol nm).
Since the magnitude of the forces are of order $10^{2}$~kJ/(mol nm), this force computing precision almost reaches the limit of the single-precision representation of the floating point numbers.
In the simulations of the RF method, the interactions were cut-off in the group manner,
so the radius for neighbor list building is set identical to the cut-off radius.
No cut-off smoothing of the electrostatic interaction was applied in the cases of RF simulation.

\begin{table}
  \centering
  \caption{A list of systems simulated in this work. We report, from left to right, the number of water
    molecules in the system (TIP3P model), equilibrium box size, length of equilibriation, length of productive trajectory.
  }
  \vskip .5cm
  \begin{tabular*}{0.5\textwidth}{@{\extracolsep{\fill}}c rrrr}\hline\hline
    System      & $N$ & $V$ [$\textrm{nm}^3$]  & $T_{\textrm{eq}}$ [ps] & $T_{\textrm{prod}}$ [ps]  \\\hline
    $\systemsbp$         &   2,500        & $4.24^3$              & --           &  6,000        \\
    $\systemsb$          & 2,500          & $4.24^3$              & 3,000        & 27,000        \\\hline
    $\systemmbp$         &   4,500        & $5.15^3$              & --           &  6,000        \\
    $\systemmb$          & 4,500          & $5.15^3$              & 3,000        & 17,000        \\\hline
    $\systemla$          &   13,824       & $7.49^3$              & 200          & 1,800         \\
    $\systemlbp$         &   13,824       & $7.49^3$              & --           & 10,000        \\
    $\systemlb$          &   13,824       & $7.49^3$              & 3,000        & 17,000        \\
    \hline\hline
  \end{tabular*}
  \label{tab:tmp1}
\end{table}

The initial configurations were prepared by in
the following steps:
(1) An NPT simulation of system $\systemla$ with SPME
electrostatic was performed. The equilibrium density (984.1~$\textrm{kg}/\textrm{m}^{3}$) of the system is calculated
from this simulation.
(2) Initial configurations that contains 2500, 4500 and
13824 molecules were generated at the calculated equilibrium
density.
(3) NVT simulations with SPME electrostatic for system $\systemsbp$, $\systemmbp$
and $\systemlbp$ are performed.
(4) The output configurations of $\systemsbp$ and $\systemmbp$ were used as
initial configurations for system $\systemsb$ and $\systemmb$, respectively.  The output configuration of
$\systemlbp$ was used as initial configurations for system $\systemla$ and $\systemlb$.
% The SPME
% parameters for all simulations reported by this work is: real space
% cut-off 1.90~nm.

% The cut-off is smoothed from 1.85 to 1.90~nm by the
% ``\texttt{switch}'' method provide by Gromacs
% 4.6~\cite{hess2008gromacs, pronk2013gromacs}. 

The smallest system $\systemsb$ was adopted,
because for the quantities that are computed  by estimating fluctuations (in this
work heat capacities, compressibility, thermal expansion coefficient, dielectric constant, diffusion constant and
viscosity are fluctuations. See details in Appendix~\ref{appendix:benchmark}), simply increase the size of the
system does not improve the accuracy of the 
simulation~\cite{milchev1986fluctuations,ferrenberg1991statistical}.
The optimal way of measuring these properties
is to simulate with smaller systems
% (as far as the finite size effect is negligible)
and run longer simulations for longer time-averages.
The reason of using Nose-Hoover thermostat is that
it perturbs the dynamics of the system only slightly, while the
Langevin thermostat is likely to substantially change the dynamics
when the coupling is very strong, therefore, the former was used in computing the dynamical
properties like the diffusion constant and viscosity.
The quantities that
are ensemble averages (in this work, pressure, chemical potential, radial distribution function and Kirkwood-G factor are of this type)
were computed by the largest system $\systemlb$,
in order to achieve higher parallel efficiency.
The system $\systemmb$ is simulated to investigate the size-dependency of the
Kirkwood-G factor~\cite{vanderSpoel2006origin}.

\section{Results and discussions}

In this section we compare the benchmark quantities of the ZM method
to the SPME method to investigate the accuracy of the former.
The comparison to the RF method will also be mentioned, to show that
the ZM is a promising replacement of the RF method.

\subsection{Thermodynamic properties}

\begin{figure}
  \centering
  \includegraphics[]{fig/nvt.pressure.1/pressure-methods.eps}
  \caption{The pressure convergence with respect to the cut-off radius.
    The ZM methods with order from 1 to 4 are compared with the RF. 
    The splitting parameter of ZM method is set to be $\alpha = 0.00\,\textrm{nm}^{-1}$.
    The black solid line indicates the magnitude  of the correct pressure: 1~Bar.
    The error bars present the statistical uncertainty at 95\% confidence level.
  }
  \label{fig:pres-comp}
\end{figure}

The equilibrium density of the system was determined by an NPT SPME
simulation.  Then using this density in the NVT simulation with SPME electrostatic, the
pressure ($-0.4\pm 1.5$~Bar) is reproducing the target pressure of
1.0~Bar, which means the system is in desired thermodynamic state.  The accuracy of ZM method, can be investigate by checking if
the NVT pressure is consistent with the target pressure, when the SPME equilibrium density is used.  In
Fig.~\ref{fig:pres-comp}, the pressure calculated by ZM method of
order $l=1,2,3$ and 4 are plotted against the cut-off radius.
All the  simulations are done with system $\systemla$.
It is concluded from the Figure that all ZM methods converges to the
target pressure at large enough cut-off radius.
In general, the higher order of ZM presents an larger error in the pressure calculation than
the lower order ZM method.
Higher order are also more sensitive in the  cut-off radius dependency.
ZM $l=1$ tends to under-estimate the pressure, while ZM $l=2,3$ and 4 tends to over-estimate.
The ZM method is also compared with
the RF method using the experimental dielectric constant $\varepsilon_{\textrm{rf}} = 80$, 
from which it is concluded that the accuracy of ZM in pressure calculation is much higher
than the RF method.
It should be noted that even with the largest system of 13824 water molecules,
the fluctuation (measured by standard deviation) of the pressure is roughly 100~Bar, which means that it is
very difficult achieve very accurate estimate for this quantity. In practice a pressure error of 20~Bar is
still acceptable. 

\begin{figure}
  \centering
  \includegraphics[width=0.24\textwidth]{fig/nvt.pressure.1/pressure-l1.eps}
  \includegraphics[width=0.24\textwidth]{fig/nvt.pressure.1/pressure-l2.eps}\\
  \includegraphics[width=0.24\textwidth]{fig/nvt.pressure.1/pressure-l3.eps}
  \includegraphics[width=0.24\textwidth]{fig/nvt.pressure.1/pressure-l4.eps}
  \caption{The pressure convergence with respect to the cut-off radius
    for ZM methods with  splitting parameter from $0.0$ to $2.0\,\textrm{nm}^{-1}$.
    From left to right, up to down presents the ZM method of order 1 to 4.
    The black solid line indicates the magnitude  of the correct pressure: 1~Bar.
    The error bars present the statistical uncertainty at 95\% confidence level.
  }
  \label{fig:pres-l1}
\end{figure}

The effect of using different splitting parameter on the convergence
of the pressure is investigate in Fig.~\ref{fig:pres-l1}.
In general, the higher order indicates less significant dependency on the splitting parameter.
In the case of $l=1$, the splitting parameter 0.0 is consistent with  $0.5\,\textrm{nm}^{-1}$, and
by using higher splitting parameter, the pressure shifts to the higher pressure side.
For $l=2,3$ and 4, the convergence is not sensitive to $\alpha$ up to  $1.0\,\textrm{nm}^{-1}$.
More importantly,  by using $\alpha = 1.5$ or $2.0\,\textrm{nm}^{-1}$,
the pressure does not converges to the desired value 1~Bar. Therefore, the high splitting parameter
is not suggested in the simulations where the high pressure accuracy is important.

\begin{sidewaystable}
  \centering
  \caption{The excess chemical potential $\mu^\exc$, constant volume molar heat capacity $C_{v,m}$, dielectric constant $\eps$, diffusion constant $D$, viscosity $\eta$, constant pressure molar heat capacity $C_{v,m}$, isothermal compressibility $\kappa_T$ and
    thermal expansion coefficient $\alpha$
    calculated by different methods.    
    The parentheses in the last column show the statistical uncertainty
    at the confidence level of 95~\%.
    The bold numbers indicating that its deviation from the SPME result is larger than the statistical uncertainty.
  }
  \bigskip
  \centering\small\setlength\tabcolsep{2pt}
  \begin{tabular*}{0.99\textwidth}{@{\extracolsep{\fill}}cccc cccccccc}\hline\hline
    Method      &   $r_c$ &    $l$ & $\alpha$  & $\mu^\exc$  &$C_{v,m}$ & $C_{p,m}$ &   $\kappa_T$  &$\alpha$ &  $\eps$ & $D$ &  $\eta$  \\
                & [nm] & & [$\textrm{nm}^{-1}$] &   [kJ/mol] &[J/(mol K)] & [J/(mol K)] & [$10^{-10}\textrm{m}^2/\textrm{N}$] &  [$10^{-3}\textrm{K}^{-1}$]&  & [$10^{-9}\textrm{m}^2/\textrm{s}$] &  [$10^{-3}\textrm{Pa}\cdot\textrm{s}$]  \\
                &    &    &    &NVT $\systemla$&NVT $\systemsb$&  NPT $\systemsb$          &  NPT $\systemsb$    &  NPT $\systemsb$    & NVT $\systemsb$& NVT $\systemsb$    & NVT $\systemsb$       \\\hline
    SPME        &1.9 & -- &2.1 & $-26.1$ (0.2) & 72.2 (1.0)  &79.2 (0.9)           & 5.94 (0.05)               &1.03 (0.02)          & 98 (3)          &         5.86  (0.07)&         0.315  (0.007)\\
    RF          &1.2 & -- &--  & $-26.0$ (0.3) & 72.3 (0.8)  &\textbf{82.3} (1.0)  & \textbf{6.51} (0.06)      &\textbf{1.15} (0.02) & \textbf{59} (1) & \textbf{6.27} (0.19)& \textbf{0.449} (0.020)\\\hline
    ZM          &1.2 & 1  &0.0 & $-26.2$ (0.3) & 71.8 (0.9)  &78.9 (1.0)           & 5.87 (0.05)               &1.01 (0.02)          & 96 (2)          & \textbf{5.53} (0.11)& \textbf{0.346} (0.006)\\ 
    ZM          &1.2 & 1  &0.5 & $-26.4$ (0.3) & 72.3 (0.8)  &78.9 (0.9)           & 5.92 (0.05)               &\textbf{1.00} (0.02) & 97 (2)          & \textbf{5.52} (0.25)& \textbf{0.339} (0.008)\\ 
    ZM          &1.2 & 1  &1.0 & $-26.0$ (0.2) & 72.4 (0.8)  &78.4 (0.9)           & 5.95 (0.05)               &1.01 (0.02)          & 96 (2)          &        {5.78} (0.25)& \textbf{0.330} (0.011)\\ 
    ZM          &1.2 & 1  &1.5 & $-26.0$ (0.2) & 71.3 (0.8)  &80.2 (0.9)           & 5.97 (0.05)               &1.04 (0.02)          & 99 (3)          & \textbf{5.71} (0.09)&        {0.312} (0.008)\\ 
    ZM          &1.2 & 1  &2.0 & $-26.1$ (0.3) & 71.3 (0.8)  &79.4 (0.9)           & \textbf{6.05} (0.05)      &1.05 (0.02)          & 96 (3)          &        {5.90} (0.04)&        {0.307} (0.007)\\\hline
    ZM          &1.2 & 2  &0.0 & $-26.2$ (0.2) & 71.5 (0.9)  &79.7 (1.0)           & 5.95 (0.05)               &1.03 (0.02)          & 95 (3)          &         5.82  (0.27)&         0.318  (0.012)\\
    ZM          &1.2 & 3  &0.0 & $-26.2$ (0.2) & 71.6 (0.9)  &79.5 (1.0)           & 5.99 (0.05)               &1.02 (0.02)          & 96 (3)          &         5.79  (0.09)&         0.321  (0.008)\\
    ZM          &1.2 & 4  &0.0 & $-26.0$ (0.3) & 71.1 (0.8)  &79.5 (1.0)           & 5.96 (0.05)               &1.03 (0.02)          &100 (2)          &         5.89  (0.09)&         0.318  (0.013)\\
    \hline\hline
  \end{tabular*}
  \label{tab:thermo}
\end{sidewaystable}

Other thermodynamic quantities including the chemical potential,
constant volume/pressure molar heat capacity, isothermal
compressibility and heat expansion coefficient are compared in
Tab.~\ref{tab:thermo}.
The ZM results are in good consistency with the SPME results, and out-perform
the RF method.
The splitting parameter does not have significant influence on these thermodynamic quantities.
\recheck{Discussion of the energy correction in the chemical potential calculation. TO be added later}

% \begin{table}
%   \centering
%   \caption{A list of the dielectric constant calculated for different systems by different methods.
%     The parameters are provided. The parenthesises in the last column show the statistical uncertainty
%     of the last two digits up to the confidence level of 95~\%.}
%   \begin{tabular*}{0.5\textwidth}{@{\extracolsep{\fill}}cccc rr}\hline\hline
%     System & Method      &       $\alpha$ [$\textrm{nm}^{-1}$] & $r_c$ [nm] &    $l$     &       $\eps$ \\\hline
%     $\systemmb$  &       ZM          &       0.00    &       1.2     &       1       &       99.8 (3.8)\\ 
%     $\systemmb$  &       ZM          &       0.00    &       1.2     &       2       &       95.2 (3.6)\\ 
%     $\systemmb$  &       ZM          &       0.00    &       1.2     &       3       &       93.9 (3.7)\\ 
%     $\systemmb$  &       ZM          &       0.00    &       1.5     &       3       &       98.7 (3.8)\\ 
%     $\systemmb$  &       ZM          &       0.00    &       1.8     &       3       &      100.7 (3.6)\\ 
%     $\systemmb$  &       ZM          &       0.00    &       1.2     &       4       &       94.7 (3.6)\\
%     $\systemmb$   & SPME          & 2.09  & 1.9   &       --      &       98.8 (4.0) \\
%     $\systemmb$  & RF             & --  & 1.2 & -- & 60.6   (1.7) \\
%     $\systemlb$  &       ZM          &       0.00    &       1.2     &       1       &       97.1 (3.2)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       1.2     &       2       &       95.6 (3.5)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       1.2     &       3       &       95.8 (4.6)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       1.5     &       3       &       98.0 (3.3)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       1.8     &       3       &       98.9 (4.2)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       2.1     &       3       &       98.8 (3.9)\\ 
%     $\systemlb$  &       ZM          &       0.00    &       1.2     &       4       &       97.8 (3.9)\\
%    $\systemlb$   & SPME          & 2.09  & 1.9   &       --      &       98.7 (3.5) \\
%     $\systemlb$  & RF             & --  & 1.2 & -- & 60.8   (2.0) \\
%     \hline\hline
%   \end{tabular*}
%   \label{tab:tmp2}
% \end{table}

\subsection{Radial distribution function}

\begin{figure}
  \centering
  \includegraphics[]{fig/result.nvt/fig-rdf.eps}  
  \caption{The comparison of the center-of-mass radial distribution functions
    calculated by SPME, ZM and RF methods. The insert is a zoom-in of
    range 0.9 -- 1.5~nm. In the insert, the position of the cut-off
    (1.2~nm) is indicated by a vertical black line.
    For ZM method, the splitting parameter $\alpha$ was set to 0.0~$\textrm{nm}^{-1}$.
  }
  \label{fig:rdf}
\end{figure}

We plot in Fig.~\ref{fig:rdf} the center-of-mass radial distribution functions (RDFs) of TIP3P water
calculated by the SPME, ZM ($l=1,2,3$ and 4) and RF method.  The RDFs
are computed from NVT simulations of system $\systemlb$. It is
observed from the Figure that the ZM RDFs are consistency very well
with the SPME RDF, except an artificial oscillation around the
cut-off radius. Higher orders of ZM method present lower oscillation, and when
$l\geq 3$, the oscillation is almost negligible. Therefore, for the sake
of high accuracy RDF computation, the ZM method of order at least 3 should be used.

\recheck{Shall we comment here on the fact that group cut-off produces smoother RDF? Add figures in Supplementary material}

\begin{figure}
  \centering
  \includegraphics[]{fig/result.nvt/fig-rdf-l1-damp.eps}  
  \caption{
    The splitting parameter dependency in calculating the center-of-mass RDF for
    ZM method $l=1$. The insert is a zoom-in of
    range 0.9 -- 1.5~nm. In the insert, the position of the cut-off
    (1.2~nm) is indicated by a vertical black line.
  }
  \label{fig:rdf-damp}
\end{figure}

The artificial oscillation can be substantially improved by using larger splitting parameter $\alpha$.
Fig.~\ref{fig:rdf-damp} presents the RDF of ZM $l=1$ with splitting parameter from 0.0 to 2.0~$\textrm{nm}^{-1}$.
A clear trend of better RDF by using larger splitting parameter is observed.
At $\alpha = 2.0\ \textrm{nm}^{-1}$ the RDF is almost overlapping with the SPME result.

\recheck{If we want $l=2,3$, add in supplementary material..}

\subsection{Dielectric quantities}

The dielectric constant computed by ZM method at different orders are listed in Tab.~\ref{tab:thermo},
and are consistent with the SPME computed results. In contrast, the RF method has poor accuracy in
the dielectric constant.

\begin{figure}
  \centering
  \includegraphics[]{fig/result.nvt/fig-gkr.eps}
  \includegraphics[]{fig/result.nvt.small/fig-gkr-small.eps}
  \caption{The Kirkwood G-factor calculated for system $\systemlb$ (a) and $\systemmb$ (b).
    ZM method of orders $l=1,2,3$ and 4 with the cut-off 1.2~nm and splitting parameter $\alpha = 0.00\,\textrm{nm}^{-1}$ are plotted.
    The RF method is shown as an comparison, which uses a cut-off radius of 1.2~nm and dielectric constant of 80.
    The statistical uncertainty of the SPME method is presented at 95~\% confidence level with the red error bars.
  }
  \label{fig:gkr}
\end{figure}

As a measurement of the dipole correlation as a function of molecular distance, the Kirkwood-G factor
is an important quantity of the water system.
It is well know that the G-factor is system size
dependent~\cite{vanderSpoel2006origin}, therefore we show the G-factor for
system $\systemlb$ in Fig.~\ref{fig:gkr}~(a) and a smaller system $\systemmb$
in Fig.~\ref{fig:gkr} (b).  In the figures, the statistical uncertainty of
the SPME method is denoted by the red error bars. The statistical uncertainties of the
other methods are essentially of the same size as the SPME, so they are not presented in the figure for
clarity.  In the figure, ZM adopts a cut-off radius of 1.2~nm and a splitting parameter $\alpha = 0.00\,\textrm{nm}^{-1}$.
RF uses a cut-off 1.2~nm and a dielectric constant of 80.

In both the system, the RF method is qualitatively
wrong. The accuracy of the ZM method is much higher than RF.
In the system of larger size ($\systemlb$), the ZM method of $l=1$ is in consistency with the SPME method. However
order $l=2,3$ and 4  present less but still acceptable accuracy.
In the system of smaller size ($\systemmb$), ZM method of all orders are consistent with the SPME result.
This means ZM performs better in calculated Kirkwood-G factor for smaller systems.
In both systems, ZM $l=1$ presents  an artificial
oscillation around the cut-off radius (1.2~nm), while this oscillation is
not obvious for $l\geq 2$.

\begin{figure}
  \centering
  \includegraphics[]{fig/result.nvt/fig-gkr-conv.eps}
  \includegraphics[]{fig/result.nvt/fig-gkr-l3-damp.eps} 
  \caption{
    The cut-off (a) and splitting parameter (b) dependency in calculating the Kirkwood-G factor.
    The order of ZM method is $l=3$. In plot (a) the splitting parameter is $\alpha = 0.00\,\textrm{nm}^{-1}$.
    in plot (b) the cut-off radius is 1.2~nm.
    The statistical uncertainty is presented at 95~\% confidence level with the  error bars.
  }
  \label{fig:gkr-conv}
\end{figure}

The cut-off and splitting parameter dependency in calculating the Kirkwood-G factor
is presented in Fig.~\ref{fig:gkr-conv}  for ZM method of order $l=3$. With out surprising,
the Kirkwood-G factor converges to the SPME result when using increasingly large cut-off radius. 
However, unlike the case of calculating RDF, the accuracy Kirkwood-G factor is not improved
with increasing splitting parameter. This fact should be noticed in choosing parameters for
high accuracy calculation of Kirkwood-G factor.

\subsection{Dynamical quantities}

The dynamical quantities, diffusion constant and viscosity, are listed in Tab.~\ref{tab:thermo}.
The ZM method of order $l\geq 2$ can almost perfectly reproduce the SPME dynamical quantities.
The ZM order $l=1$ is of less accurate than higher orders, but is more accurate than the RF.
Using larger splitting parameters improves the accuracy, and the value $\alpha= 2.0\ \textrm{nm}^{-1}$ is
suggested for calculating the dynamical quantities.

% \subsection{Damping effect}

% The convergence of the integrated auto-correlation function $I_\eta(T) $ is shown in Fig.~\ref{fig:damp-vis-l1}.
% \begin{figure}
%   \centering
%   \includegraphics[]{fig/result.tiny/fig-vis-l1-damp.eps}
%   \caption{The convergence of the integrated auto-correlation function $I_\eta(T) $. The error bars indicating 95\% confidence level are plotted with the SPME method. The different splitting parameters for ZM $l=1$ method are plotted}
%   \label{fig:damp-vis-l1}
% \end{figure}

% The RDF is plotted for different splitting parameters $\alpha$ for ZM $l=2$ and 3 in Fig.~\ref{fig:damp-rdf-l23}. Higher $\alpha$ reproduces the RDF better.
% The system was $L_1$.
% \begin{figure}[]
%   \centering
%   \includegraphics[width=0.49\textwidth]{fig/result.nvt/fig-rdf-l2-damp.eps}
%   \includegraphics[width=0.49\textwidth]{fig/result.nvt/fig-rdf-l3-damp.eps}
%   \caption{Radial distribution function for different splitting parameters $\alpha$ for ZM $l=2$ (left) and $l=3$ (right).}
%   \label{fig:damp-rdf-l23}
% \end{figure}

% The
% resulting slop is used to calculate the diffusion constant. The results are listed in Table~\ref{tab:thermo}.
% The ZM method $l\geq 2$ is consistent with the SPME
% result, while the RF method is off. 

\appendix

\section{The computation of benchmark quantities}
\label{appendix:benchmark}

In this section we provide the formula used for computing the benchmark quantities. We assume that there are
$N$ molecules in the water system. The position and configuration of each molecule are fully described
by $\{\vect r_{3i},\vect r_{3i+1}, \vect r_{3i+2}\},\, i\in 1,\cdots,N$, and the corresponding velocities
are denoted by $\{\vect v_{3i},\vect v_{3i+1}, \vect v_{3i+2}\},\, i\in 1,\cdots,N$. The mass of each
atom is denoted by $m_i$.

\subsection{Radial distribution function}
The radial distribution function (RDF) $g(r)$ is a scalar function of distance $r$, which indicates the
probability of finding two atoms of distance $r$ apart.  It is a very
important equilibrium structure property, by which the X-ray scattering
intensity and a mount of thermodynamic properties can be computed.
In this work, we investigate the center-of-mass RDF in the water
system. The RDFs presented in the main text were computed in system $\systemlb$.

% The results are plotted in Fig.~\ref{fig:rdf}. As the order of ZM method goes higher, the precision of RDF improves. In addition, the precision of RF method is between $l=2$ and $l=3$.

\subsection{Pressure}
The pressure of the system calculated by the virial formula:
\begin{align}
  P = \frac1{3V}
  \Bigg\langle
  \sum_{i=1}^{3N} \Big( m_i\vect v_i^2 + \vect r_i\cdot \vect F_i \Big)
  \Bigg\rangle,
\end{align}
where $V$ is the volume of the system. The presented pressures were computed in system $\systemla$.

\subsection{Chemical potential}

The chemical potential is defined by
\begin{align}
  \mu = \Big(\frac{\partial A}{\partial N}\Big)_{V,T},
\end{align}
where $A$ is the Helmholtz free energy.
In practice the excess chemical potential $\mu^\exc$, which is the
chemical potential abstracted by the kinetic contribution, is of
special interest. We calculate the excess chemical potential by the
thermodynamic integration (TI). In this approach, the interaction
between an inserted testing molecule and the system is
denoted by $U_t(\lambda)$, where $\lambda$
is a coupling parameter in range $[0,1]$.
When $\lambda = 1$ the testing molecule is fully coupled to the system
with the TIP3P interaction. When $\lambda=0$, the testing molecule
is decoupled with the system.
Therefore the
Hamiltonian of the system is function of the coupling parameter. The
excess chemical is calculated by the free energy difference between
the fully coupled and decoupled states:
\begin{align}
  \mu^\exc = \int_0^1 \Big\langle \frac{\partial U_t(\lambda)}{\partial \lambda} \Big\rangle_\lambda d\lambda
\end{align}
This integral is usually calculated by numerical integration, which
equally partitions the range of $\lambda$, simulates the system at each
discretized $\lambda$, and computes chemical potential by trapezoidal formula.
Here for the sake of accuracy, 
we adopt a two step coupling approach: firstly couple the van der Waals
interaction of the testing particle with the rest of the system (stage vdw),
and then couple the electrostatic interaction (stage ele).
During stage vdw, 21 $\lambda$ values are equally
distributed in $[0,1]$.  During stage ele, 6 $\lambda$ values are
equally distributed in $[0,0.05]$, while the other 20 $\lambda$ values
are equally distributed in $(0.05, 1]$. Therefore, in total 47
simulations are performed for all $\lambda$ values.
The free energy differences and the error estimates are calculated
by the Bennet's acceptance ratio method (BAR)~\cite{bennett1976efficient}. 
The simulations were performed with system $\systemla$.

\subsection{Constant volume/pressure molar heat capacity}

The constant volume heat capacity is defined by the infinitesimal
increment of the energy due to an infinitesimal increment of the temperature
at constant volume condition: 
\begin{align}
  C_V = \Big(\frac{\partial E}{\partial T}\Big)_V
\end{align}
Since it is a extensive thermodynamics quantity, we  normalize
it by the number molecules in the system $N$ to obtain the
constant volume molar heat capacity $C_{V,m} = C_V/N$.
In the MD simulations, 
the constant volume molar heat capacity is calculated by estimating the
fluctuation of the Hamiltonian in an NVT simulation:
\begin{align}
  C_{V,m} = \frac{1}{k_BT^2 N} \langle (\mathcal H - \langle\mathcal H\rangle)^2 \rangle,
\end{align}
where $\mathcal H$ is the 
Hamiltonian of the system. 
% It is calculated in system $\systemsb$.

The constant pressure molar heat capacity is defined in
a similar way, but at constant pressure
condition. 
It is calculated by estimating
the fluctuation of the enthalpy in an NPT simulation~\cite{wang2011existence}:
\begin{align}
  C_{p,m} = \frac{1}{k_BT^2 N} \langle ( H - \langle H\rangle)^2 \rangle,
\end{align}
where $ H$ is the enthalpy of the system,
defined by $H = \mathcal H + P\mathcal V$, and $\mathcal V$ is the instantaneous volume
of the system.
It has been shown that the statistical error in estimating
the fluctuations does not decrease with
respect to the system size~\cite{milchev1986fluctuations,ferrenberg1991statistical}.
Therefore, both constant volume and pressure molar heat capacities
were calculated from the simulation of the smallest system: $\systemsb$.

\subsection{Isothermal heat capacity}
The isothermal heat capacity is defined
by the normalized increment of volume due to an infinitesimal
decrement of pressure under constant temperature condition:
\begin{align}
  \kappa_T = - \frac 1V \Big(\frac{\partial V}{\partial P}\Big)_T
\end{align}
It can be calculated by estimating the fluctuation
of the instantaneous volume in an NPT simulation~\cite{wang2011existence}:
\begin{align}
  \kappa_T = \frac{1}{k_BT} \frac{\langle (\mathcal V - \langle \mathcal V\rangle)^2 \rangle}{\langle \mathcal V\rangle}.
\end{align}
Since it is also a fluctuation, the system $\systemsb$ was adopted for simulation.

\subsection{Thermal expansion coefficient}
The thermal expansion coefficient is defined by
the normalized increment of volume due to an infinitesimal
increment of temperature under the constant pressure condition:
\begin{align}
  \alpha_V = - \frac 1V \Big(\frac{\partial V}{\partial T}\Big)_P
\end{align}
It can be calculated by estimating the cross fluctuation
of the enthalpy and instantaneous volume  in an NPT simulation:
\begin{align}
  \alpha_V = \frac{1}{k_BT^2\langle \mathcal V\rangle} \langle (H - \langle H\rangle)\cdot(\mathcal V - \langle \mathcal V\rangle) \rangle
\end{align}
The system $\systemsb$ was adopted for simulation.


\subsection{The dielectric constant}

The dielectric constant can be estimated in a direct manner:
\begin{align}
  \eps = 1 + \frac{1}{3L^3 k_BT} ( \langle \vert \vect M\vert^2\rangle - \vert\langle \vect M\rangle\vert^2 )
\end{align}
where
\begin{align}
  \vect M = \sum_i\boldsymbol\mu_i = \sum_{\alpha\in i} q_\alpha\vect r_\alpha
\end{align}
is the total dipole moment of the system. Since it is a fluctuation, the simulated system was $\systemsb$.
% The results are listed in Tab.~\ref{tab:tmp2}. The dielectric constant calculated in system $\systemsb$ is reported in Table.~\ref{tab:thermo}.

\subsection{Kirkwood G-factor}

The Kirkwood G-factor is defined by~\cite{vanderSpoel2006origin}
\begin{align}
  G_k(r) =
  \Big\langle
  \frac 1N
  \sum_{i=1}^N \sum_{j, r_{ij} < r}
  \frac {\boldsymbol\mu_i \cdot \boldsymbol\mu_j}{\vert \boldsymbol\mu_i\vert \cdot \vert\boldsymbol\mu_j\vert}
  \Big\rangle,
\end{align}
where $r_{ij}$ denotes the oxygen-oxygen distance between two water
molecules.  The system for computing this quantity is $\systemlb$.

\subsection{Diffusion constant}
The diffusion constant is calculated from the Einstein relation:
\begin{align}
  D = \lim_{t\rightarrow \infty}\frac {1}{6t} \langle \vert \vect r_i(t) - \vect r_i(0)\vert^2\rangle.
\end{align}
In practice, the mean-square-displacement $\langle\vert \vect r_i(t) - \vect
r_i(0)\vert^2\rangle$ is calculated, then the value is linearly fitted. The system for simulation was $\systemsb$.

\subsection{Viscosity}
The viscosity is calculated from the Green-Kubo relation:
\begin{align}
  \eta = \frac{V}{k_BT}\int_0^\infty\langle P_{\alpha\beta}(0) P_{\alpha\beta}(t)\rangle\,dt, \quad \alpha,\beta \in \{x, y, z\}
\end{align}
where $\alpha$ and $\beta$ denote the directions, and
$P_{\alpha\beta}$ denotes the off-diagonal components of the pressure
tensor. Since we used the isotropic system setting, then it is obvious
that $P_{xy}$, $P_{yz}$ and $P_{xz}$ are equivalent. Moreover, it has
been pointed out that in addition $(P_{xx} - P_{yy})/2$ and $(P_{xx} -
P_{yy})/2$ are two independent components that are equivalent to the
first three~\cite{alfe1998first}. Therefore, the viscosity is
calculated from the auto-correlation functions of five independent
components, and the statistical error is estimated from the standard
deviation of the viscosities calculated from the five components.

We investigate the convergence of the integral of the auto-correlation function w.r.t.~time:
\begin{align}
  I_\eta(T) = \frac{V}{k_BT}\int_0^T\langle P_{\alpha\beta}(0) P_{\alpha\beta}(t)\rangle\,dt,
\end{align}
and plot the function $I_\eta(T) $ for all method in
Fig.~\ref{fig:conv-vis}.  It is clear the integral for the RF method
converges at 6~ps, while the ZM method converges only in 2~ps, which
is consistent with the SPME result.  The value of ZM $l=1$ method is
different from the rest ZM method an SPME result.
The values listed  in Table~\ref{tab:thermo} are computed with $I_\eta(10\,\textrm{ps})$.
The
system for simulation was $\systemsb$.

\begin{figure}
  \centering
  \includegraphics[]{fig/result.tiny/fig-vis.eps}
  \caption{The convergence of the integrated auto-correlation function $I_\eta(T) $. The error bars indicating 95\% confidence level are plotted with the SPME method.}
  \label{fig:conv-vis}
\end{figure}


\newpage
\bibliography{ref}{}
\bibliographystyle{unsrt}

\end{document}
